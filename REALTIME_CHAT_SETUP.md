# Real-time Chat Setup Guide

This guide will help you set up the real-time chat feature in your application using Supabase.

## Prerequisites

1. A Supabase project
2. Environment variables configured
3. Node.js and npm installed

## Setup Steps

### 1. Environment Variables

Make sure your `.env` file contains the following variables:

```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_KEY=your_supabase_anon_key
```

### 2. Database Setup

1. Open your Supabase dashboard
2. Go to the SQL Editor
3. Run the SQL script from `setup-realtime-chat.sql`

Alternatively, you can run these commands manually:

```sql
-- Create the messages table
CREATE TABLE messages (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  username VARCHAR NOT NULL,
  text TEXT NOT NULL,
  country VARCHAR,
  is_authenticated BOOLEAN DEFAULT FALSE,
  timestamp timestamp default now() NOT NULL
);

-- Enable realtime
ALTER PUBLICATION supabase_realtime ADD TABLE messages;
```

### 3. Enable Realtime

**Important**: In your Supabase dashboard:
1. Go to Database â†’ Replication
2. Find the `messages` table
3. Toggle "Enable Realtime" to ON

### 4. Test the Setup

1. Start your development server:
   ```bash
   npm run dev
   ```

2. Navigate to the TeamSpace page
3. Go to the Messages tab
4. Try sending a message
5. Open another browser window/tab to test real-time functionality

## Features

### âœ… Implemented Features

- **Real-time messaging**: Messages appear instantly across all connected clients
- **Country flags**: Automatic country detection with flag display
- **Authentication status**: Shows verified badge for authenticated users
- **Message history**: Loads previous messages with pagination
- **Responsive design**: Works on desktop and mobile
- **Auto-scroll**: Automatically scrolls to new messages
- **Unread message counter**: Shows count of unviewed messages
- **Message validation**: Prevents empty messages and limits length
- **Error handling**: Graceful error handling with user feedback

### ðŸ”§ Technical Details

- **Database**: PostgreSQL with Supabase
- **Real-time**: Supabase Realtime API
- **Frontend**: React with TypeScript
- **UI**: Tailwind CSS with shadcn/ui components
- **State Management**: React hooks

### ðŸŽ¨ UI Components

The chat interface includes:
- Message bubbles with sender info
- Country flags and authentication badges
- Timestamp formatting (relative time)
- Scroll-to-bottom button with unread counter
- Loading states and error handling
- Responsive layout

### ðŸ”’ Security

- Row Level Security (RLS) enabled
- Message sanitization
- Input validation
- Rate limiting (can be added)

## Troubleshooting

### Common Issues

1. **Messages not appearing in real-time**
   - Check if Realtime is enabled for the messages table
   - Verify environment variables are correct
   - Check browser console for errors

2. **Country flags not showing**
   - This is normal if the geolocation API fails
   - Falls back to timezone-based detection

3. **Authentication status not working**
   - Ensure user is properly authenticated
   - Check Supabase auth configuration

### Debug Steps

1. Check browser console for errors
2. Verify Supabase connection in Network tab
3. Test database queries in Supabase SQL editor
4. Check if realtime subscription is active

## Customization

### Adding Team-specific Chat

To make the chat team-specific instead of global:

1. Add a `team_id` column to the messages table
2. Update the real-time subscription to filter by team
3. Modify the insert query to include team_id

### Adding More Features

- **File uploads**: Add file attachment support
- **Message reactions**: Add emoji reactions
- **Typing indicators**: Show when users are typing
- **Message editing**: Allow users to edit their messages
- **Message threading**: Add reply functionality

## Support

If you encounter any issues:
1. Check the browser console for errors
2. Verify your Supabase configuration
3. Test the database connection
4. Review the setup steps above

The real-time chat feature is now ready to use! ðŸŽ‰
