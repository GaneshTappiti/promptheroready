/*! For license information please see 7430.7feae008.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkpromptheroready=self.webpackChunkpromptheroready||[]).push([[7430],{9855:(e,a,s)=>{s.d(a,{A:()=>t});const t=(0,s(77784).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},15049:(e,a,s)=>{s.r(a),s.d(a,{default:()=>E});var t=s(89379),r=s(65043),i=s(6742),l=s(8567),d=s(69772),c=s(49954),n=s(22822),o=s(75990),h=s(70492),m=s(47631),x=s(41736),u=s(51704),v=s(50516),p=s(71360),g=s(88693),j=s(39292),w=s(42489),b=s(14459),y=s(72629),N=s(37719),f=s(82054),A=s(26533),_=s(9855),k=s(35087),C=s(75088),S=s(70579);const E=()=>{const{adminUser:e,isSuperAdmin:a}=(0,m.z8)(),{toast:s}=(0,u.dj)(),[E,M]=(0,r.useState)([]),[D,L]=(0,r.useState)([]),[z,q]=(0,r.useState)(!0),[U,$]=(0,r.useState)(""),[F,R]=(0,r.useState)(!1),[V,Z]=(0,r.useState)(null),[H,O]=(0,r.useState)({email:"",role:"admin"});(0,r.useEffect)(()=>{a&&(J(),W())},[a]);const J=async()=>{try{q(!0);const{data:e,error:a}=await x.ND.from("admin_users").select("\n          *,\n          user_email:user_id (email)\n        ").order("created_at",{ascending:!1});if(a)throw a;const s=(null===e||void 0===e?void 0:e.map(e=>{var a;return(0,t.A)((0,t.A)({},e),{},{user_email:(null===(a=e.user_email)||void 0===a?void 0:a.email)||"Unknown"})}))||[];M(s)}catch(e){console.error("Error fetching admin users:",e),s({title:"Error",description:"Failed to fetch admin users",variant:"destructive"})}finally{q(!1)}},W=async()=>{try{const{data:e,error:a}=await x.ND.from("admin_audit_log").select("*").order("created_at",{ascending:!1}).limit(50);if(a)throw a;L(e||[])}catch(e){console.error("Error fetching audit logs:",e)}},B=async(a,s,t,r,i)=>{try{await x.ND.from("admin_audit_log").insert([{admin_user_id:null===e||void 0===e?void 0:e.id,action:a,resource_type:s,resource_id:t,old_values:r,new_values:i}])}catch(l){console.error("Error logging audit action:",l)}},I=()=>{O({email:"",role:"admin"})},Y=E.filter(e=>{var a;return(null===(a=e.user_email)||void 0===a?void 0:a.toLowerCase().includes(U.toLowerCase()))||e.role.toLowerCase().includes(U.toLowerCase())}),G=e=>{switch(e){case"super_admin":return(0,S.jsx)(l.E,{className:"bg-purple-600/20 text-purple-400 border-purple-500/30",children:"Super Admin"});case"admin":return(0,S.jsx)(l.E,{className:"bg-blue-600/20 text-blue-400 border-blue-500/30",children:"Admin"});default:return(0,S.jsx)(l.E,{variant:"secondary",children:e})}};return a?z?(0,S.jsxs)("div",{className:"space-y-6",children:[(0,S.jsxs)("div",{className:"flex items-center justify-between",children:[(0,S.jsx)("h1",{className:"text-3xl font-bold text-white",children:"Role Management"}),(0,S.jsx)("div",{className:"animate-pulse h-8 w-32 bg-white/10 rounded"})]}),(0,S.jsx)("div",{className:"grid gap-6",children:[...Array(3)].map((e,a)=>(0,S.jsx)(i.Zp,{className:"workspace-card animate-pulse",children:(0,S.jsx)(i.Wu,{className:"p-6",children:(0,S.jsx)("div",{className:"h-24 bg-white/10 rounded"})})},a))})]}):(0,S.jsxs)("div",{className:"space-y-6",children:[(0,S.jsxs)("div",{className:"flex items-center justify-between",children:[(0,S.jsxs)("div",{children:[(0,S.jsx)("h1",{className:"text-3xl font-bold text-white",children:"Role Management"}),(0,S.jsx)("p",{className:"text-gray-400 mt-1",children:"Manage admin users and view audit logs"})]}),(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsxs)(d.$,{onClick:()=>{J(),W()},variant:"outline",size:"sm",className:"border-white/20 text-white hover:bg-white/10",children:[(0,S.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Refresh"]}),(0,S.jsxs)(h.lG,{open:F,onOpenChange:R,children:[(0,S.jsx)(h.zM,{asChild:!0,children:(0,S.jsxs)(d.$,{className:"bg-green-600 hover:bg-green-700 text-white",children:[(0,S.jsx)(p.A,{className:"mr-2 h-4 w-4"}),"Add Admin"]})}),(0,S.jsxs)(h.Cf,{className:"bg-black/90 backdrop-blur-xl border-white/10 text-white",children:[(0,S.jsx)(h.c7,{children:(0,S.jsx)(h.L3,{children:"Add New Admin User"})}),(0,S.jsxs)("div",{className:"space-y-4",children:[(0,S.jsxs)("div",{children:[(0,S.jsx)(n.J,{htmlFor:"email",children:"User Email"}),(0,S.jsx)(c.p,{id:"email",type:"email",value:H.email,onChange:e=>O(a=>(0,t.A)((0,t.A)({},a),{},{email:e.target.value})),className:"bg-black/20 border-white/20 text-white",placeholder:"user@example.com"})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)(n.J,{htmlFor:"role",children:"Role"}),(0,S.jsxs)(o.l6,{value:H.role,onValueChange:e=>O(a=>(0,t.A)((0,t.A)({},a),{},{role:e})),children:[(0,S.jsx)(o.bq,{className:"bg-black/20 border-white/20 text-white",children:(0,S.jsx)(o.yv,{})}),(0,S.jsxs)(o.gC,{className:"bg-black/90 border-white/20",children:[(0,S.jsx)(o.eb,{value:"admin",children:"Admin"}),(0,S.jsx)(o.eb,{value:"super_admin",children:"Super Admin"})]})]})]}),(0,S.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,S.jsx)(d.$,{variant:"outline",onClick:()=>{R(!1),I()},className:"border-white/20 text-white hover:bg-white/10",children:"Cancel"}),(0,S.jsxs)(d.$,{onClick:async()=>{try{const{data:a,error:t}=await x.ND.from("auth.users").select("id").eq("email",H.email).single();if(t)return void s({title:"Error",description:"User not found with that email address",variant:"destructive"});const{data:r,error:i}=await x.ND.from("admin_users").insert([{user_id:a.id,role:H.role,is_active:!0,created_by:null===e||void 0===e?void 0:e.id}]).select().single();if(i)throw i;await B("admin_created","admin_user",r.id,null,{role:H.role,email:H.email}),await J(),R(!1),I(),s({title:"Success",description:"Admin user created successfully with ".concat(H.role," role")})}catch(a){console.error("Error creating admin user:",a),s({title:"Error",description:"Failed to create admin user",variant:"destructive"})}},className:"bg-green-600 hover:bg-green-700 text-white",disabled:!H.email,children:[(0,S.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Add Admin"]})]})]})]})]})]})]}),(0,S.jsx)(i.Zp,{className:"workspace-card",children:(0,S.jsx)(i.Wu,{className:"p-4",children:(0,S.jsxs)("div",{className:"relative",children:[(0,S.jsx)(j.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,S.jsx)(c.p,{placeholder:"Search admin users...",value:U,onChange:e=>$(e.target.value),className:"pl-10 bg-black/20 border-white/20 text-white"})]})})}),(0,S.jsxs)(i.Zp,{className:"workspace-card",children:[(0,S.jsx)(i.aR,{children:(0,S.jsxs)(i.ZB,{className:"text-white flex items-center gap-2",children:[(0,S.jsx)(w.A,{className:"h-5 w-5 text-green-400"}),"Admin Users (",Y.length,")"]})}),(0,S.jsx)(i.Wu,{children:(0,S.jsx)("div",{className:"space-y-4",children:0===Y.length?(0,S.jsxs)("div",{className:"text-center py-8",children:[(0,S.jsx)(b.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,S.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"No admin users found"}),(0,S.jsx)("p",{className:"text-gray-400",children:U?"Try adjusting your search":"Add your first admin user to get started"})]}):Y.map(a=>{return(0,S.jsxs)("div",{className:"flex items-center justify-between p-4 bg-black/20 rounded-lg border border-white/10",children:[(0,S.jsxs)("div",{className:"flex items-center gap-4",children:[(0,S.jsx)("div",{className:"p-2 bg-green-600/20 rounded-lg",children:"super_admin"===a.role?(0,S.jsx)(y.A,{className:"h-5 w-5 text-purple-400"}):(0,S.jsx)(b.A,{className:"h-5 w-5 text-blue-400"})}),(0,S.jsxs)("div",{children:[(0,S.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,S.jsx)("p",{className:"text-white font-medium",children:a.user_email}),G(a.role),(t=a.is_active,t?(0,S.jsx)(l.E,{className:"bg-green-600/20 text-green-400 border-green-500/30",children:"Active"}):(0,S.jsx)(l.E,{className:"bg-red-600/20 text-red-400 border-red-500/30",children:"Inactive"})),a.user_id===(null===e||void 0===e?void 0:e.id)&&(0,S.jsx)(l.E,{variant:"outline",className:"text-xs border-yellow-500/30 text-yellow-400",children:"You"})]}),(0,S.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-400",children:[(0,S.jsxs)("span",{children:["Created: ",new Date(a.created_at).toLocaleDateString()]}),a.last_login_at&&(0,S.jsxs)("span",{children:["Last login: ",new Date(a.last_login_at).toLocaleDateString()]})]})]})]}),(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)(d.$,{variant:"ghost",size:"sm",onClick:()=>(async a=>{if(a.user_id!==(null===e||void 0===e?void 0:e.id))try{const e=!a.is_active,{error:t}=await x.ND.from("admin_users").update({is_active:e,updated_at:(new Date).toISOString()}).eq("id",a.id);if(t)throw t;await B(e?"admin_activated":"admin_deactivated","admin_user",a.id,{is_active:a.is_active},{is_active:e}),await J(),s({title:"Success",description:"Admin user ".concat(e?"activated":"deactivated"," successfully")})}catch(t){console.error("Error toggling admin status:",t),s({title:"Error",description:"Failed to update admin status",variant:"destructive"})}else s({title:"Error",description:"You cannot deactivate your own account",variant:"destructive"})})(a),disabled:a.user_id===(null===e||void 0===e?void 0:e.id),className:"text-gray-400 hover:bg-white/10 ".concat(a.is_active?"hover:text-red-400":"hover:text-green-400"),children:a.is_active?(0,S.jsx)(N.A,{className:"h-4 w-4"}):(0,S.jsx)(f.A,{className:"h-4 w-4"})}),(0,S.jsx)(d.$,{variant:"ghost",size:"sm",onClick:()=>(e=>{Z(e),O({email:e.user_email||"",role:e.role})})(a),className:"text-gray-400 hover:text-white hover:bg-white/10",children:(0,S.jsx)(A.A,{className:"h-4 w-4"})}),(0,S.jsx)(d.$,{variant:"ghost",size:"sm",onClick:()=>(async a=>{if(a.user_id!==(null===e||void 0===e?void 0:e.id)){if(confirm("Are you sure you want to delete admin access for ".concat(a.user_email,"?")))try{const{error:e}=await x.ND.from("admin_users").delete().eq("id",a.id);if(e)throw e;await B("admin_deleted","admin_user",a.id,{role:a.role,email:a.user_email},null),await J(),s({title:"Success",description:"Admin user deleted successfully"})}catch(t){console.error("Error deleting admin user:",t),s({title:"Error",description:"Failed to delete admin user",variant:"destructive"})}}else s({title:"Error",description:"You cannot delete your own account",variant:"destructive"})})(a),disabled:a.user_id===(null===e||void 0===e?void 0:e.id),className:"text-gray-400 hover:text-red-400 hover:bg-red-500/10",children:(0,S.jsx)(_.A,{className:"h-4 w-4"})})]})]},a.id);var t})})})]}),(0,S.jsxs)(i.Zp,{className:"workspace-card",children:[(0,S.jsx)(i.aR,{children:(0,S.jsxs)(i.ZB,{className:"text-white flex items-center gap-2",children:[(0,S.jsx)(k.A,{className:"h-5 w-5 text-green-400"}),"Recent Audit Logs"]})}),(0,S.jsx)(i.Wu,{children:(0,S.jsx)("div",{className:"space-y-3",children:0===D.length?(0,S.jsxs)("div",{className:"text-center py-8",children:[(0,S.jsx)(C.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,S.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"No audit logs"}),(0,S.jsx)("p",{className:"text-gray-400",children:"Admin actions will be logged here"})]}):D.slice(0,10).map(e=>(0,S.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-black/20 rounded-lg border border-white/10",children:[(0,S.jsx)("div",{className:"p-1.5 bg-blue-600/20 rounded",children:(0,S.jsx)(C.A,{className:"h-3 w-3 text-blue-400"})}),(0,S.jsxs)("div",{className:"flex-1",children:[(0,S.jsx)("p",{className:"text-white text-sm",children:e.action.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),(0,S.jsxs)("p",{className:"text-gray-400 text-xs",children:[e.resource_type," \u2022 ",new Date(e.created_at).toLocaleString()]})]})]},e.id))})})]}),(0,S.jsx)(h.lG,{open:!!V,onOpenChange:e=>!e&&Z(null),children:(0,S.jsxs)(h.Cf,{className:"bg-black/90 backdrop-blur-xl border-white/10 text-white",children:[(0,S.jsx)(h.c7,{children:(0,S.jsx)(h.L3,{children:"Edit Admin User"})}),(0,S.jsxs)("div",{className:"space-y-4",children:[(0,S.jsxs)("div",{children:[(0,S.jsx)(n.J,{children:"Email"}),(0,S.jsx)(c.p,{value:H.email,disabled:!0,className:"bg-black/20 border-white/20 text-gray-400"})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)(n.J,{htmlFor:"edit-role",children:"Role"}),(0,S.jsxs)(o.l6,{value:H.role,onValueChange:e=>O(a=>(0,t.A)((0,t.A)({},a),{},{role:e})),children:[(0,S.jsx)(o.bq,{className:"bg-black/20 border-white/20 text-white",children:(0,S.jsx)(o.yv,{})}),(0,S.jsxs)(o.gC,{className:"bg-black/90 border-white/20",children:[(0,S.jsx)(o.eb,{value:"admin",children:"Admin"}),(0,S.jsx)(o.eb,{value:"super_admin",children:"Super Admin"})]})]})]}),(0,S.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,S.jsx)(d.$,{variant:"outline",onClick:()=>{Z(null),I()},className:"border-white/20 text-white hover:bg-white/10",children:"Cancel"}),(0,S.jsxs)(d.$,{onClick:async()=>{if(V)try{const e={role:V.role,is_active:V.is_active},{data:a,error:t}=await x.ND.from("admin_users").update({role:H.role,updated_at:(new Date).toISOString()}).eq("id",V.id).select().single();if(t)throw t;await B("admin_updated","admin_user",V.id,e,{role:H.role}),await J(),Z(null),I(),s({title:"Success",description:"Admin user updated successfully"})}catch(e){console.error("Error updating admin user:",e),s({title:"Error",description:"Failed to update admin user",variant:"destructive"})}},className:"bg-green-600 hover:bg-green-700 text-white",children:[(0,S.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Update Admin"]})]})]})]})})]}):(0,S.jsxs)("div",{className:"text-center text-white",children:[(0,S.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Access Denied"}),(0,S.jsx)("p",{children:"Only Super Admins can access role management."})]})}},26533:(e,a,s)=>{s.d(a,{A:()=>t});const t=(0,s(77784).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},35087:(e,a,s)=>{s.d(a,{A:()=>t});const t=(0,s(77784).A)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},39292:(e,a,s)=>{s.d(a,{A:()=>t});const t=(0,s(77784).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},71360:(e,a,s)=>{s.d(a,{A:()=>t});const t=(0,s(77784).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},72629:(e,a,s)=>{s.d(a,{A:()=>t});const t=(0,s(77784).A)("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]])},75088:(e,a,s)=>{s.d(a,{A:()=>t});const t=(0,s(77784).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},82054:(e,a,s)=>{s.d(a,{A:()=>t});const t=(0,s(77784).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},88693:(e,a,s)=>{s.d(a,{A:()=>t});const t=(0,s(77784).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])}}]);
//# sourceMappingURL=7430.7feae008.chunk.js.map