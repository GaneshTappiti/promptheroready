"use strict";(self.webpackChunkpromptheroready=self.webpackChunkpromptheroready||[]).push([[5187],{35187:(e,s,t)=>{t.r(s),t.d(s,{default:()=>f});var a=t(9950),r=t(16255),c=t(38493),i=t(60348),n=t(27711),l=t(15924),o=t(77737),d=t(45833),m=t(66987),x=t(53270),h=t(58406),u=t(25692),g=t(6890),p=t(25391),j=t(27549);class w{static async getSlowQueries(){try{const{data:e,error:s}=await j.ND.rpc("get_slow_queries",{threshold_ms:this.SLOW_QUERY_THRESHOLD});return s?(console.warn("Could not fetch slow queries (pg_stat_statements may not be enabled):",s),[]):e||[]}catch(e){return console.warn("Error fetching slow queries:",e),[]}}static async getConnectionStats(){try{const{data:e,error:s}=await j.ND.rpc("get_connection_stats");return s?(console.warn("Could not fetch connection stats:",s),{active:0,idle:0,total:0}):e||{active:0,idle:0,total:0}}catch(e){return console.warn("Error fetching connection stats:",e),{active:0,idle:0,total:0}}}static async getIndexUsage(){try{const{data:e,error:s}=await j.ND.rpc("get_index_usage");return s?(console.warn("Could not fetch index usage:",s),[]):e||[]}catch(e){return console.warn("Error fetching index usage:",e),[]}}static async getPerformanceMetrics(){const[e,s,t]=await Promise.all([this.getSlowQueries(),this.getConnectionStats(),this.getIndexUsage()]);return{slowQueries:e,connectionCount:s.total,cacheHitRatio:0,indexUsage:t}}static analyzeSlowQueries(e){const s=[];for(const t of e){const e=1e3*parseFloat(t.avgTime.replace("s",""));e>5e3?s.push({query:t.query.substring(0,100)+"...",issue:"Very slow query (".concat(t.avgTime," avg)"),recommendation:"Consider adding indexes, optimizing joins, or caching results",priority:"high"}):e>2e3&&s.push({query:t.query.substring(0,100)+"...",issue:"Slow query (".concat(t.avgTime," avg)"),recommendation:"Review query execution plan and consider optimization",priority:"medium"}),(t.query.includes("pg_class")||t.query.includes("pg_namespace")||t.query.includes("pg_get_tabledef")||t.query.includes("pg_get_viewdef"))&&s.push({query:t.query.substring(0,100)+"...",issue:"Expensive schema introspection query",recommendation:"Cache schema information or reduce frequency of schema queries",priority:"high"})}return s}static async generatePerformanceReport(){const e=await this.getPerformanceMetrics(),s=this.analyzeSlowQueries(e.slowQueries),t=e.slowQueries.length>0?e.slowQueries.reduce((e,s)=>e+parseFloat(s.avgTime.replace("s","")),0)/e.slowQueries.length:0;return{metrics:e,recommendations:s,summary:{totalSlowQueries:e.slowQueries.length,highPriorityIssues:s.filter(e=>"high"===e.priority).length,avgQueryTime:t}}}}w.SLOW_QUERY_THRESHOLD=1e3;(()=>{let e})();var y=t(44414);const N=()=>{const[e,s]=(0,a.useState)(null),[t,j]=(0,a.useState)(!1),[N,f]=(0,a.useState)(null),v=async()=>{j(!0);try{const e=await w.generatePerformanceReport(),t=await w.getConnectionStats();s({slowQueries:e.metrics.slowQueries,recommendations:e.recommendations,summary:e.summary,connectionStats:t}),f(new Date)}catch(e){console.error("Failed to fetch performance data:",e)}finally{j(!1)}};(0,a.useEffect)(()=>{v();const e=setInterval(v,3e5);return()=>clearInterval(e)},[]);const b=e=>{switch(e){case"high":return"bg-red-500";case"medium":return"bg-yellow-500";case"low":return"bg-blue-500";default:return"bg-gray-500"}},Q=(()=>{if(!e)return{status:"unknown",color:"gray"};const{highPriorityIssues:s,avgQueryTime:t}=e.summary;return s>3||t>3?{status:"critical",color:"red",icon:l.A}:s>0||t>1?{status:"warning",color:"yellow",icon:o.A}:{status:"healthy",color:"green",icon:d.A}})();return(0,y.jsxs)("div",{className:"space-y-6",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Database Performance"}),(0,y.jsx)("p",{className:"text-gray-400",children:"Monitor and optimize database query performance"})]}),(0,y.jsxs)("div",{className:"flex items-center gap-3",children:[N&&(0,y.jsxs)("span",{className:"text-sm text-gray-400",children:["Last updated: ",N.toLocaleTimeString()]}),(0,y.jsxs)(c.$,{onClick:v,disabled:t,variant:"outline",size:"sm",className:"border-white/20 text-white hover:bg-white/10",children:[(0,y.jsx)(m.A,{className:"h-4 w-4 mr-2 ".concat(t?"animate-spin":"")}),"Refresh"]})]})]}),(0,y.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,y.jsx)(r.Zp,{className:"workspace-card",children:(0,y.jsx)(r.Wu,{className:"p-4",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("p",{className:"text-sm text-gray-400",children:"System Health"}),(0,y.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,y.jsx)(Q.icon,{className:"h-5 w-5 text-".concat(Q.color,"-400")}),(0,y.jsx)("span",{className:"text-white font-medium capitalize",children:Q.status})]})]}),(0,y.jsx)(x.A,{className:"h-8 w-8 text-blue-400"})]})})}),(0,y.jsx)(r.Zp,{className:"workspace-card",children:(0,y.jsx)(r.Wu,{className:"p-4",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("p",{className:"text-sm text-gray-400",children:"Slow Queries"}),(0,y.jsx)("p",{className:"text-2xl font-bold text-white",children:(null===e||void 0===e?void 0:e.summary.totalSlowQueries)||0})]}),(0,y.jsx)(o.A,{className:"h-8 w-8 text-yellow-400"})]})})}),(0,y.jsx)(r.Zp,{className:"workspace-card",children:(0,y.jsx)(r.Wu,{className:"p-4",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("p",{className:"text-sm text-gray-400",children:"High Priority Issues"}),(0,y.jsx)("p",{className:"text-2xl font-bold text-white",children:(null===e||void 0===e?void 0:e.summary.highPriorityIssues)||0})]}),(0,y.jsx)(l.A,{className:"h-8 w-8 text-red-400"})]})})}),(0,y.jsx)(r.Zp,{className:"workspace-card",children:(0,y.jsx)(r.Wu,{className:"p-4",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("p",{className:"text-sm text-gray-400",children:"Avg Query Time"}),(0,y.jsxs)("p",{className:"text-2xl font-bold text-white",children:[(null===e||void 0===e?void 0:e.summary.avgQueryTime.toFixed(2))||"0.00","s"]})]}),(0,y.jsx)(h.A,{className:"h-8 w-8 text-green-400"})]})})})]}),(null===e||void 0===e?void 0:e.connectionStats)&&(0,y.jsxs)(r.Zp,{className:"workspace-card",children:[(0,y.jsx)(r.aR,{children:(0,y.jsxs)(r.ZB,{className:"text-white flex items-center gap-2",children:[(0,y.jsx)(u.A,{className:"h-5 w-5"}),"Database Connections"]})}),(0,y.jsx)(r.Wu,{children:(0,y.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("p",{className:"text-2xl font-bold text-green-400",children:e.connectionStats.active}),(0,y.jsx)("p",{className:"text-sm text-gray-400",children:"Active"})]}),(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("p",{className:"text-2xl font-bold text-blue-400",children:e.connectionStats.idle}),(0,y.jsx)("p",{className:"text-sm text-gray-400",children:"Idle"})]}),(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("p",{className:"text-2xl font-bold text-white",children:e.connectionStats.total}),(0,y.jsx)("p",{className:"text-sm text-gray-400",children:"Total"})]})]})})]}),(null===e||void 0===e?void 0:e.recommendations)&&e.recommendations.length>0&&(0,y.jsxs)(r.Zp,{className:"workspace-card",children:[(0,y.jsx)(r.aR,{children:(0,y.jsxs)(r.ZB,{className:"text-white flex items-center gap-2",children:[(0,y.jsx)(g.A,{className:"h-5 w-5"}),"Performance Recommendations"]})}),(0,y.jsx)(r.Wu,{className:"space-y-3",children:e.recommendations.slice(0,5).map((e,s)=>(0,y.jsxs)(n.Fc,{className:"border-yellow-600/20 bg-yellow-600/10",children:[(0,y.jsx)(l.A,{className:"h-4 w-4 text-yellow-400"}),(0,y.jsx)(n.TN,{className:"text-yellow-200",children:(0,y.jsx)("div",{className:"flex items-start justify-between",children:(0,y.jsxs)("div",{className:"flex-1",children:[(0,y.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,y.jsx)(i.E,{className:"".concat(b(e.priority)," text-white text-xs"),children:e.priority.toUpperCase()}),(0,y.jsx)("span",{className:"font-medium",children:e.issue})]}),(0,y.jsx)("p",{className:"text-sm",children:e.recommendation}),(0,y.jsx)("p",{className:"text-xs text-yellow-300 mt-1 font-mono",children:e.query})]})})})]},s))})]}),(null===e||void 0===e?void 0:e.slowQueries)&&e.slowQueries.length>0&&(0,y.jsxs)(r.Zp,{className:"workspace-card",children:[(0,y.jsx)(r.aR,{children:(0,y.jsxs)(r.ZB,{className:"text-white flex items-center gap-2",children:[(0,y.jsx)(p.A,{className:"h-5 w-5"}),"Slow Queries (",e.slowQueries.length,")"]})}),(0,y.jsx)(r.Wu,{children:(0,y.jsx)("div",{className:"space-y-3",children:e.slowQueries.slice(0,10).map((e,s)=>(0,y.jsxs)("div",{className:"border border-white/10 rounded-lg p-3",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,y.jsxs)(i.E,{variant:"outline",className:"text-red-400 border-red-400",children:[e.avgTime," avg"]}),(0,y.jsxs)("span",{className:"text-sm text-gray-400",children:[e.calls," calls"]})]}),(0,y.jsx)("code",{className:"text-xs text-gray-300 block bg-black/20 p-2 rounded",children:e.query.length>200?e.query.substring(0,200)+"...":e.query})]},s))})})]}),!t&&!e&&(0,y.jsx)(r.Zp,{className:"workspace-card",children:(0,y.jsxs)(r.Wu,{className:"text-center py-8",children:[(0,y.jsx)(x.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,y.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"No Performance Data"}),(0,y.jsx)("p",{className:"text-gray-400 mb-4",children:"Performance monitoring requires pg_stat_statements extension to be enabled."}),(0,y.jsx)(c.$,{onClick:v,variant:"outline",children:"Try Again"})]})})]})},f=()=>(0,y.jsx)("div",{className:"space-y-6",children:(0,y.jsx)(N,{})})}}]);