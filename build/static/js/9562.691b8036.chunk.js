"use strict";(self.webpackChunkpromptheroready=self.webpackChunkpromptheroready||[]).push([[9562],{39562:(e,s,t)=>{t.r(s),t.d(s,{default:()=>I});var a=t(9950),n=t(16255),r=t(38493),i=t(60348),c=t(94208),l=t(14697),o=t(41591),d=t(91367),m=t(21273),h=t(27549);class g{constructor(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"test-team";this.testUserId=void 0,this.testTeamId=void 0,this.activeChannels=[],this.testUserId=e,this.testTeamId=s}async testBasicConnection(){const e=Date.now();try{const s=h.ND.channel("connection_test"),t=new Promise((e,t)=>{const a=setTimeout(()=>{t(new Error("Connection timeout after 5 seconds"))},5e3);s.subscribe(s=>{clearTimeout(a),"SUBSCRIBED"===s?e(!0):"CHANNEL_ERROR"===s&&t(new Error("Connection failed with status: ".concat(s)))})});return await t,this.activeChannels.push(s),{success:!0,message:"WebSocket connection established successfully",duration:Date.now()-e,data:{status:"SUBSCRIBED"}}}catch(s){return{success:!1,message:"WebSocket connection failed",duration:Date.now()-e,error:s instanceof Error?s.message:"Unknown error"}}}async testGlobalMessaging(){const e=Date.now();try{const s="Test message ".concat(Date.now());let t=!1;const a=h.ND.channel("global_messages_test").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>{e.new.text===s&&(t=!0)}).subscribe();this.activeChannels.push(a),await new Promise(e=>setTimeout(e,1e3));const{error:n}=await h.ND.from("messages").insert([{text:s,username:"test_user_".concat(this.testUserId),country:"Test",is_authenticated:!0}]);if(n)throw n;if(await new Promise(e=>setTimeout(e,2e3)),!t)throw new Error("Message was sent but not received via real-time subscription");return{success:!0,message:"Global messaging working correctly",duration:Date.now()-e,data:{messageReceived:!0,testMessage:s}}}catch(s){return{success:!1,message:"Global messaging test failed",duration:Date.now()-e,error:s instanceof Error?s.message:"Unknown error"}}}async testTeamMessaging(){const e=Date.now();try{const s="Team test message ".concat(Date.now());let t=!1;const{error:a}=await h.ND.from("teams").upsert([{id:this.testTeamId,name:"Test Team",description:"Test team for real-time testing",created_by:this.testUserId}],{onConflict:"id"});a&&console.warn("Team creation warning:",a);const n=h.ND.channel("team_messages_".concat(this.testTeamId)).on("postgres_changes",{event:"INSERT",schema:"public",table:"team_messages",filter:"team_id=eq.".concat(this.testTeamId)},e=>{e.new.content===s&&(t=!0)}).subscribe();this.activeChannels.push(n),await new Promise(e=>setTimeout(e,1e3));const{error:r}=await h.ND.from("team_messages").insert([{team_id:this.testTeamId,sender_id:this.testUserId,sender_name:"Test User",content:s,avatar:"",country:"Test",is_authenticated:!0}]);if(r)throw r;if(await new Promise(e=>setTimeout(e,2e3)),!t)throw new Error("Team message was sent but not received via real-time subscription");return{success:!0,message:"Team messaging working correctly",duration:Date.now()-e,data:{messageReceived:!0,testMessage:s,teamId:this.testTeamId}}}catch(s){return{success:!1,message:"Team messaging test failed",duration:Date.now()-e,error:s instanceof Error?s.message:"Unknown error"}}}async testPresenceTracking(){const e=Date.now();try{let s=!1;const t=h.ND.channel("team_presence_".concat(this.testTeamId),{config:{presence:{key:this.testUserId}}});return t.on("presence",{event:"sync"},()=>{s=!0}),await new Promise((e,s)=>{const a=setTimeout(()=>{s(new Error("Presence subscription timeout"))},5e3);t.subscribe(async n=>{clearTimeout(a),"SUBSCRIBED"===n?(await t.track({user_id:this.testUserId,user_name:"Test User",online_at:(new Date).toISOString()}),e()):s(new Error("Presence subscription failed: ".concat(n)))})}),this.activeChannels.push(t),await new Promise(e=>setTimeout(e,2e3)),{success:!0,message:"Presence tracking working correctly",duration:Date.now()-e,data:{presenceUpdated:s,userId:this.testUserId}}}catch(s){return{success:!1,message:"Presence tracking test failed",duration:Date.now()-e,error:s instanceof Error?s.message:"Unknown error"}}}async testTypingIndicators(){const e=Date.now();try{let s=!1,t=!1;const a=h.ND.channel("typing_".concat(this.testTeamId)).on("broadcast",{event:"typing"},e=>{e.payload.user_id===this.testUserId&&(s=!0)}).on("broadcast",{event:"stop_typing"},e=>{e.payload.user_id===this.testUserId&&(t=!0)}).subscribe();if(this.activeChannels.push(a),await new Promise(e=>setTimeout(e,1e3)),await a.send({type:"broadcast",event:"typing",payload:{user_id:this.testUserId,user_name:"Test User",team_id:this.testTeamId,timestamp:(new Date).toISOString()}}),await new Promise(e=>setTimeout(e,500)),await a.send({type:"broadcast",event:"stop_typing",payload:{user_id:this.testUserId,user_name:"Test User",team_id:this.testTeamId}}),await new Promise(e=>setTimeout(e,1e3)),!s||!t)throw new Error("Typing indicators not received properly");return{success:!0,message:"Typing indicators working correctly",duration:Date.now()-e,data:{typingReceived:s,stopTypingReceived:t}}}catch(s){return{success:!1,message:"Typing indicators test failed",duration:Date.now()-e,error:s instanceof Error?s.message:"Unknown error"}}}async testConcurrentConnections(){const e=Date.now();try{const s=[],t=5;for(let e=0;e<t;e++){const t=new Promise((s,t)=>{const a=h.ND.channel("concurrent_test_".concat(e)),n=setTimeout(()=>{t(new Error("Channel ".concat(e," connection timeout")))},5e3);a.subscribe(r=>{clearTimeout(n),"SUBSCRIBED"===r?(this.activeChannels.push(a),s(!0)):t(new Error("Channel ".concat(e," failed: ").concat(r)))})});s.push(t)}return await Promise.all(s),{success:!0,message:"".concat(t," concurrent connections established successfully"),duration:Date.now()-e,data:{channelCount:t,activeChannels:this.activeChannels.length}}}catch(s){return{success:!1,message:"Concurrent connections test failed",duration:Date.now()-e,error:s instanceof Error?s.message:"Unknown error"}}}async runAllTests(){console.log("\ud83d\udd04 Starting Real-time Features Tests...");const e=new Map,s=[{name:"Basic WebSocket Connection",test:()=>this.testBasicConnection()},{name:"Global Messaging",test:()=>this.testGlobalMessaging()},{name:"Team Messaging",test:()=>this.testTeamMessaging()},{name:"Presence Tracking",test:()=>this.testPresenceTracking()},{name:"Typing Indicators",test:()=>this.testTypingIndicators()},{name:"Concurrent Connections",test:()=>this.testConcurrentConnections()}];for(const{name:n,test:r}of s){console.log("Testing: ".concat(n,"..."));try{const s=await r();e.set(n,s)}catch(a){e.set(n,{success:!1,message:"Test execution failed",duration:0,error:a instanceof Error?a.message:"Unknown error"})}}const t=this.generateTestSummary(e);return console.log("\ud83c\udfaf Real-time Tests Complete:",t),{results:e,summary:t}}cleanup(){console.log("\ud83e\uddf9 Cleaning up ".concat(this.activeChannels.length," test channels...")),this.activeChannels.forEach(e=>{try{h.ND.removeChannel(e)}catch(s){console.warn("Error removing channel:",s)}}),this.activeChannels=[]}generateTestSummary(e){const s=e.size,t=Array.from(e.values()).filter(e=>e.success).length,a=s-t,n=Array.from(e.values()).reduce((e,s)=>e+s.duration,0)/s;return{total:s,passed:t,failed:a,successRate:(t/s*100).toFixed(1)+"%",avgDuration:Math.round(n)+"ms"}}}"undefined"!==typeof window&&(window.realtimeTest={RealtimeTester:g,runTests:async(e,s)=>{const t=new g(e,s),a=await t.runAllTests();return t.cleanup(),a}});var u=t(45833),x=t(81850),p=t(36542),w=t(58406),y=t(25692),j=t(61878),N=t(66987),v=t(30621),b=t(2737),f=t(77737),T=t(29975),C=t(73581),S=t(7838),D=t(44414);const I=()=>{const{user:e}=(0,d.A)(),{toast:s}=(0,m.dj)(),[t,I]=(0,a.useState)(new Map),[R,_]=(0,a.useState)(!1),[k,E]=(0,a.useState)(0),[U,A]=(0,a.useState)(""),[P,B]=(0,a.useState)(null),[M,W]=(0,a.useState)(null),[Z,F]=(0,a.useState)(""),[L,G]=(0,a.useState)([]),[z,q]=(0,a.useState)(!1),[O,$]=(0,a.useState)("Disconnected"),[H,J]=(0,a.useState)([]);(0,a.useEffect)(()=>{if(e){const s=new g(e.id,"test-team-".concat(e.id));W(s)}return()=>{M&&M.cleanup()}},[e]);const K=async()=>{if(e&&Z.trim())try{var t;const{error:a}=await h.ND.from("messages").insert([{text:Z,username:(null===(t=e.email)||void 0===t?void 0:t.split("@")[0])||"Test User",country:"Test",is_authenticated:!0}]);if(a)throw a;F(""),s({title:"Message Sent",description:"Message sent via real-time system",variant:"default"})}catch(a){s({title:"Send Failed",description:"Could not send message",variant:"destructive"})}},Q=e=>(0,D.jsx)(i.E,{variant:e?"default":"destructive",children:e?"PASS":"FAIL"});return(0,D.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 p-6",children:(0,D.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,D.jsxs)("div",{className:"text-center",children:[(0,D.jsxs)("h1",{className:"text-3xl font-bold text-white mb-2 flex items-center justify-center gap-2",children:[(0,D.jsx)(p.A,{className:"h-8 w-8 text-blue-400"}),"Real-time Features Testing"]}),(0,D.jsx)("p",{className:"text-gray-400",children:"Test WebSocket connections and team collaboration features"})]}),(0,D.jsxs)(n.Zp,{className:"bg-gray-800/50 border-gray-700",children:[(0,D.jsx)(n.aR,{children:(0,D.jsxs)(n.ZB,{className:"text-white flex items-center gap-2",children:[(0,D.jsx)(w.A,{className:"h-5 w-5"}),"Connection Status"]})}),(0,D.jsx)(n.Wu,{children:(0,D.jsxs)("div",{className:"flex items-center gap-4",children:[(0,D.jsxs)("div",{className:"flex items-center gap-2",children:[(0,D.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(z?"bg-green-400":"bg-red-400")}),(0,D.jsx)("span",{className:"text-white",children:O})]}),(0,D.jsxs)(r.$,{onClick:async()=>{if(e)try{h.ND.channel("live_test_connection").subscribe(e=>{$(e),q("SUBSCRIBED"===e)});h.ND.channel("live_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>{G(s=>[e.new,...s.slice(0,9)])}).subscribe();s({title:"Live Test Started",description:"Connected to real-time message stream",variant:"default"})}catch(t){s({title:"Live Test Failed",description:"Could not connect to real-time stream",variant:"destructive"})}},size:"sm",variant:"outline",children:[(0,D.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Test Live Connection"]})]})})]}),(0,D.jsxs)(n.Zp,{className:"bg-gray-800/50 border-gray-700",children:[(0,D.jsx)(n.aR,{children:(0,D.jsxs)(n.ZB,{className:"text-white flex items-center gap-2",children:[(0,D.jsx)(j.A,{className:"h-5 w-5"}),"Comprehensive Real-time Tests"]})}),(0,D.jsxs)(n.Wu,{className:"space-y-4",children:[(0,D.jsxs)("div",{className:"flex items-center gap-4",children:[(0,D.jsxs)(r.$,{onClick:async()=>{if(e&&M){_(!0),E(0),I(new Map),B(null);try{const e=["Initializing WebSocket connection...","Testing basic connectivity...","Testing global messaging...","Testing team messaging...","Testing presence tracking...","Testing typing indicators...","Testing concurrent connections...","Generating test report..."];for(let s=0;s<e.length;s++)A(e[s]),E(s/e.length*100),await new Promise(e=>setTimeout(e,500));const{results:t,summary:a}=await M.runAllTests();I(t),B(a),E(100),A("Tests completed!"),s({title:"Real-time Tests Complete",description:"".concat(a.passed,"/").concat(a.total," tests passed (").concat(a.successRate,")"),variant:0===a.failed?"default":"destructive"})}catch(t){console.error("Test execution failed:",t),s({title:"Test Execution Failed",description:t instanceof Error?t.message:"Unknown error occurred",variant:"destructive"})}finally{_(!1)}}else s({title:"Authentication Required",description:"Please log in to run real-time tests",variant:"destructive"})},disabled:R||!e,className:"flex items-center gap-2",children:[R?(0,D.jsx)(N.A,{className:"h-4 w-4 animate-spin"}):(0,D.jsx)(v.A,{className:"h-4 w-4"}),R?"Running Tests...":"Run All Real-time Tests"]}),!e&&(0,D.jsx)(i.E,{variant:"destructive",children:"Login Required"})]}),R&&(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between",children:[(0,D.jsx)("span",{className:"text-sm text-gray-400",children:U}),(0,D.jsxs)("span",{className:"text-sm text-gray-400",children:[Math.round(k),"%"]})]}),(0,D.jsx)(c.k,{value:k,className:"w-full"})]}),P&&(0,D.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-gray-700/30 rounded-lg",children:[(0,D.jsxs)("div",{className:"text-center",children:[(0,D.jsx)("p",{className:"text-2xl font-bold text-blue-400",children:P.total}),(0,D.jsx)("p",{className:"text-gray-400 text-sm",children:"Total Tests"})]}),(0,D.jsxs)("div",{className:"text-center",children:[(0,D.jsx)("p",{className:"text-2xl font-bold text-green-400",children:P.passed}),(0,D.jsx)("p",{className:"text-gray-400 text-sm",children:"Passed"})]}),(0,D.jsxs)("div",{className:"text-center",children:[(0,D.jsx)("p",{className:"text-2xl font-bold text-red-400",children:P.failed}),(0,D.jsx)("p",{className:"text-gray-400 text-sm",children:"Failed"})]}),(0,D.jsxs)("div",{className:"text-center",children:[(0,D.jsx)("p",{className:"text-2xl font-bold text-yellow-400",children:P.successRate}),(0,D.jsx)("p",{className:"text-gray-400 text-sm",children:"Success Rate"})]})]})]})]}),(0,D.jsxs)(n.Zp,{className:"bg-gray-800/50 border-gray-700",children:[(0,D.jsx)(n.aR,{children:(0,D.jsxs)(n.ZB,{className:"text-white flex items-center gap-2",children:[(0,D.jsx)(b.A,{className:"h-5 w-5"}),"Live Message Testing"]})}),(0,D.jsxs)(n.Wu,{className:"space-y-4",children:[(0,D.jsxs)("div",{className:"flex gap-2",children:[(0,D.jsx)(l.p,{value:Z,onChange:e=>F(e.target.value),placeholder:"Type a test message...",className:"bg-gray-700/50 border-gray-600 text-white",onKeyPress:e=>"Enter"===e.key&&K()}),(0,D.jsx)(r.$,{onClick:K,disabled:!Z.trim()||!e,children:(0,D.jsx)(b.A,{className:"h-4 w-4"})})]}),L.length>0&&(0,D.jsxs)("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:[(0,D.jsx)(o.J,{className:"text-gray-300",children:"Recent Messages (Real-time)"}),L.map((e,s)=>(0,D.jsxs)("div",{className:"p-2 bg-gray-700/30 rounded text-sm",children:[(0,D.jsxs)("span",{className:"text-blue-400",children:[e.username,":"]}),(0,D.jsx)("span",{className:"text-white ml-2",children:e.text})]},s))]})]})]}),t.size>0&&(0,D.jsxs)(n.Zp,{className:"bg-gray-800/50 border-gray-700",children:[(0,D.jsx)(n.aR,{children:(0,D.jsx)(n.ZB,{className:"text-white",children:"Test Results"})}),(0,D.jsx)(n.Wu,{children:(0,D.jsx)("div",{className:"space-y-3",children:Array.from(t.entries()).map(e=>{let[s,t]=e;return(0,D.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-700/30 rounded-lg",children:[(0,D.jsxs)("div",{className:"flex items-center gap-3",children:[(a=t.success,a?(0,D.jsx)(u.A,{className:"h-4 w-4 text-green-400"}):(0,D.jsx)(x.A,{className:"h-4 w-4 text-red-400"})),(0,D.jsxs)("div",{children:[(0,D.jsx)("p",{className:"text-white font-medium",children:s}),(0,D.jsx)("p",{className:"text-gray-400 text-sm",children:t.message}),t.error&&(0,D.jsxs)("p",{className:"text-red-400 text-xs mt-1",children:["Error: ",t.error]})]})]}),(0,D.jsxs)("div",{className:"flex items-center gap-2",children:[(0,D.jsx)("div",{className:"text-right",children:(0,D.jsxs)("p",{className:"text-gray-400 text-xs flex items-center gap-1",children:[(0,D.jsx)(f.A,{className:"h-3 w-3"}),t.duration,"ms"]})}),Q(t.success)]})]},s);var a})})})]}),(0,D.jsxs)(n.Zp,{className:"bg-gray-800/50 border-gray-700",children:[(0,D.jsx)(n.aR,{children:(0,D.jsx)(n.ZB,{className:"text-white",children:"Real-time Features in Application"})}),(0,D.jsx)(n.Wu,{children:(0,D.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,D.jsxs)("div",{className:"p-4 bg-gray-700/30 rounded-lg",children:[(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,D.jsx)(j.A,{className:"h-5 w-5 text-blue-400"}),(0,D.jsx)("h3",{className:"text-white font-semibold",children:"Global Chat"})]}),(0,D.jsx)("p",{className:"text-gray-400 text-sm",children:"Real-time messaging for all users"})]}),(0,D.jsxs)("div",{className:"p-4 bg-gray-700/30 rounded-lg",children:[(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,D.jsx)(T.A,{className:"h-5 w-5 text-green-400"}),(0,D.jsx)("h3",{className:"text-white font-semibold",children:"Team Chat"})]}),(0,D.jsx)("p",{className:"text-gray-400 text-sm",children:"Team-specific messaging and collaboration"})]}),(0,D.jsxs)("div",{className:"p-4 bg-gray-700/30 rounded-lg",children:[(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,D.jsx)(C.A,{className:"h-5 w-5 text-yellow-400"}),(0,D.jsx)("h3",{className:"text-white font-semibold",children:"Presence Tracking"})]}),(0,D.jsx)("p",{className:"text-gray-400 text-sm",children:"See who's online and active"})]}),(0,D.jsxs)("div",{className:"p-4 bg-gray-700/30 rounded-lg",children:[(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,D.jsx)(S.A,{className:"h-5 w-5 text-purple-400"}),(0,D.jsx)("h3",{className:"text-white font-semibold",children:"Typing Indicators"})]}),(0,D.jsx)("p",{className:"text-gray-400 text-sm",children:"Real-time typing status updates"})]}),(0,D.jsxs)("div",{className:"p-4 bg-gray-700/30 rounded-lg",children:[(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,D.jsx)(w.A,{className:"h-5 w-5 text-red-400"}),(0,D.jsx)("h3",{className:"text-white font-semibold",children:"Live Updates"})]}),(0,D.jsx)("p",{className:"text-gray-400 text-sm",children:"Real-time task and project updates"})]}),(0,D.jsxs)("div",{className:"p-4 bg-gray-700/30 rounded-lg",children:[(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,D.jsx)(p.A,{className:"h-5 w-5 text-cyan-400"}),(0,D.jsx)("h3",{className:"text-white font-semibold",children:"WebSocket Infrastructure"})]}),(0,D.jsx)("p",{className:"text-gray-400 text-sm",children:"Supabase real-time subscriptions"})]})]})})]})]})})}}}]);